local Library = loadstring(game:HttpGetAsync("https://github.com/ActualMasterOogway/Fluent-Renewed/releases/latest/download/Fluent.luau"))()
local SaveManager = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/SaveManager.luau"))()
local InterfaceManager = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/InterfaceManager.luau"))()

local Window = Library:Window{
    Title = "CHub - Pull A Sword",
    SubTitle = "By coco",
    TabWidth = 100,
    Size =  UDim2.fromOffset(420, 350),
    Resize = false, 
    Theme = "United GNOME",
    MinimizeKey = Enum.KeyCode.LeftShift
}

-- Tabs
local Tabs = {
    XMAS = Window:CreateTab{Title = "XMAS", Icon = "phosphor-sword-bold"},
    preXmas = Window:CreateTab{Title = "Pre-XMAS", Icon = "phosphor-sword-bold"},
    Fishing = Window:CreateTab{Title = "Fishing", Icon = "phosphor-sword-bold"},
    PvP = Window:CreateTab{Title = "PvP", Icon = "phosphor-sword-bold"},
    Settings = Window:CreateTab{Title = "Settings", Icon = "phosphor-sword-bold"}
}

local Options = Library.Options

Tabs.Fishing:CreateToggle("AutoFishBad", {Title = "Auto Fish (Bad)", Default = false})
    :OnChanged(function(state)
        local plr = game.Players.LocalPlayer
        local char = plr.Character or plr.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        if state then
            task.spawn(function()
                local Fishing = game.ReplicatedStorage.Remotes.Fishing
                while Options.AutoFishBad.Value and char.Parent do
                    hrp.CFrame = CFrame.new(-890, 10, -246)
                    task.wait(2)
                    hrp.Anchored = true
                    Fishing.CastRod:InvokeServer()
                    local start = tick()
                    while tick() - start < 18 do
                        Fishing.PlayerReaction:FireServer()
                        task.wait(0.05)
                    end
                    Fishing.ReelIn:FireServer(2.5)
                    Fishing.Stop:FireServer()
                    task.wait(1)
                end
                hrp.Anchored = false
            end)
        else
            hrp.Anchored = false
        end
    end)

Tabs.Fishing:CreateToggle("GenCrystals", {
    Title = "Generate Crystals",
    Default = false
}):OnChanged(function(state)
    local r = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events")

    if state then
        r.RemoveC:FireServer(1)
        task.spawn(function()
            while Options.GenCrystals.Value do
                for i = 1, 20 do
                    r.WinMegaBossEvent:FireServer("Dragon6", "Normal")
                end
                task.wait()
            end
        end)
    else
        r.RemoveC:FireServer(0)
    end
end)

Tabs.Fishing:CreateButton{
    Title = "Cartographer Pieces",
    Description = "Collect all Cartographer Pieces instantly",
    Callback = function()

        local Players = game:GetService("Players")
        local player = Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")

        local function fireTouchOnce(obj)
            local part = obj:FindFirstAncestorWhichIsA("BasePart")
            if part and firetouchinterest then
                task.spawn(function()
                    firetouchinterest(part, root, 1)
                    task.wait()
                    firetouchinterest(part, root, 0)
                end)
            end
        end

        for _, d in ipairs(workspace:GetDescendants()) do
            if d:IsA("TouchTransmitter") then
                fireTouchOnce(d)
            end
        end

    end
}

local rRemoveC = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events"):WaitForChild("RemoveC")
local rBossEvent = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events"):WaitForChild("WinBossEvent")
local rPortalC = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events"):WaitForChild("PortalC")

Tabs.preXmas:CreateToggle("GenMaterials", {
    Title = "Inf Materials (XMAS)",
    Default = false
}):OnChanged(function(state)
    if state then
        rPortalC:FireServer("2", true)

        rRemoveC:FireServer(1)

        task.spawn(function()
            while Options.GenMaterials.Value do
                for i = 1, 2 do
                    rBossEvent:FireServer("Boss1")
                end
                task.wait()
            end
        end)
    else
        rRemoveC:FireServer(0)
    end
end)


local rCraft = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events"):WaitForChild("BuyIngredientForXmas")
local selectedItemNumber = 1

local preXmasItemDropdown = Tabs.preXmas:CreateDropdown("SelectXmasItem", {
    Title = "Select Xmas Item",
    Values = {"Cookies Book", "Santas Helper", "Santas GreatSword", "Strength Potion", "Mega Potion"},
    Default = "Cookies Book"
}):OnChanged(function(value)
    if value == "Cookies Book" then
        selectedItemNumber = 1
    elseif value == "Santas Helper" then
        selectedItemNumber = 2
    elseif value == "Santas GreatSword" then
        selectedItemNumber = 3
    elseif value == "Strength Potion" then
        selectedItemNumber = 11
    elseif value == "Mega Potion" then
        selectedItemNumber = 12
    end
end)

Tabs.preXmas:CreateToggle("AutoCraftXmasItem", {
    Title = "Auto Craft Xmas Item",
    Default = false
}):OnChanged(function(state)
    if state then
        task.spawn(function()
            while Options.AutoCraftXmasItem.Value do
                local args = {selectedItemNumber}
                rCraft:FireServer(unpack(args))
                task.wait(1)
            end
        end)
    end
end)

local rBuy = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events"):WaitForChild("BuyIngredientForXmas")
local selectedMaterial = "RedRibbons"

local preXmasDropdown = Tabs.preXmas:CreateDropdown("SelectMaterial", {
    Title = "Select Material",
    Values = {"Red Ribbons", "Bell", "Wrapping Paper", "Elfs Clue", "Lump Of Coal", "Paint Bucket"},
    Default = "Red Ribbons"
}):OnChanged(function(value)
    if value == "Red Ribbons" then
        selectedMaterial = "RedRibbons"
    elseif value == "Bell" then
        selectedMaterial = "Bell"
    elseif value == "Wrapping Paper" then
        selectedMaterial = "WrappingPaper"
    elseif value == "Elfs Clue" then
        selectedMaterial = "ElfsClue"
    elseif value == "Lump Of Coal" then
        selectedMaterial = "LumpOfCoal"
    elseif value == "Paint Bucket" then
        selectedMaterial = "PaintBucket"
    end
end)

Tabs.preXmas:CreateToggle("AutoBuy", {
    Title = "Auto Buy",
    Default = false
}):OnChanged(function(state)
    if state then
        task.spawn(function()
            while Options.AutoBuy.Value do
                rBuy:FireServer(selectedMaterial)
                task.wait(1)
            end
        end)
    end
end)


Tabs.preXmas:CreateToggle("AutoBuyAll", {
    Title = "Auto Buy All",
    Default = false
}):OnChanged(function(state)
    if state then
        task.spawn(function()
            while Options.AutoBuyAll.Value do
                local allMaterials = {"RedRibbons", "Bell", "WrappingPaper", "ElfsClue", "LumpOfCoal", "PaintBucket"}
                for _, material in ipairs(allMaterials) do
                    rBuy:FireServer(material)
                end
                task.wait(1)
            end
        end)
    end
end)

Tabs.preXmas:CreateButton({
    Title = "Claim XMAS Daily",
    Callback = function()
        local r = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events")
        for i = 1, 25 do
            local args = {i}
            r.ClaimXmasBlessing:FireServer(unpack(args))
            task.wait(0.05)
        end
    end
})

Tabs.XMAS:CreateToggle("PresentTeleport", {Title = "Teleport Presents", Default = false})
    :OnChanged(function(state)
        if state then
            task.spawn(function()
                local Players = game:GetService("Players")
                local player = Players.LocalPlayer
                local presentNames = {
                    "Present_1",
                    "Present_2",
                    "Present_3",
                    "Present_4",
                    "Present_5",
                    "Present_6",
                    "Present_7",
                    "Present_8",
                    "Present_9",
                    "Present_10",
                }

                while Options.PresentTeleport.Value do
                    local character = player.Character or player.CharacterAdded:Wait()
                    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

                    for _, name in ipairs(presentNames) do
                        if not Options.PresentTeleport.Value then break end

                        local model = workspace:FindFirstChild(name, true)
                        if model and model:IsA("Model") then
                            local part = model.PrimaryPart or model:FindFirstChildWhichIsA("BasePart")
                            if part then
                                humanoidRootPart.CFrame = part.CFrame + Vector3.new(0, 15, 0)
                                task.wait(1)
                            end
                        end
                    end

                    task.wait()
                end
            end)
        end
    end)

Tabs.XMAS:CreateButton{
    Title = "Use Christmas Portal",
    Description = "Teleports you to XMAS World",
    Callback = function()

        local Players = game:GetService("Players")
        local player = Players.LocalPlayer
        local character = player.Character or player.CharacterAdded:Wait()
        local root = character:WaitForChild("HumanoidRootPart")
        local targetCFrame = CFrame.new(5716, 324, 10209)
        root.CFrame = targetCFrame
    end
}

Tabs.XMAS:CreateButton{
    Title = "Open Workshop", 
    Description = "Opens Work Shop", 
    Callback = function()
        local player = game.Players.LocalPlayer
        local letter = player.PlayerGui.MainUI.UI_Group.XmasWorkhop
        letter.Visible = true

    end
}

Tabs.XMAS:CreateButton{
    Title = "Open Glove Shop", 
    Description = "Opens Glove Shop", 
    Callback = function()
        local player = game.Players.LocalPlayer
        local letter = player.PlayerGui.MainUI.UI_Group.SantaBossClicks
        letter.Visible = true

    end
}


local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local function getPlayerNames()
    local t = {}
    for _, player in ipairs(Players:GetPlayers()) do
        table.insert(t, player.Name)
    end
    return t
end

local playerNames = getPlayerNames()

-- Buy Potions Toggle
local buyPotionsToggle = Tabs.PvP:CreateToggle("BuyPotions", {
    Title = "Buy Potions",
    Default = false
})

buyPotionsToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            while buyPotionsToggle.Value do
                local remotes = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Events")
                remotes.HalloweenShopEvent:FireServer("WinsPotions")
                remotes.HalloweenShopEvent:FireServer("ShinyPotions")
                task.wait()
            end
        end)
    end
end)

local autoPvPToggle = Tabs.PvP:CreateToggle("AutoPvP", {
    Title = "Auto PvP",
    Default = false
})

local dropdownRef = Tabs.PvP:CreateDropdown("PvPTarget", {
    Title = "Select PvP Target",
    Values = playerNames,
    Default = playerNames[1] or ""
})

autoPvPToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            while autoPvPToggle.Value do
                local r = ReplicatedStorage.Remotes.Events
                local targetName = dropdownRef.Value
                if targetName and targetName ~= "" then
                    r.WinEvent_PVP:FireServer(targetName, true, true)
                end
                task.wait(0.7)
            end
        end)
    end
end)

-- Refresh Players Button
Tabs.PvP:CreateButton({
    Title = "Refresh Players",
    Callback = function()
        playerNames = getPlayerNames()
        dropdownRef:SetValues(playerNames)
        dropdownRef:SetValue(playerNames[1] or "")
    end
})

local notepvp = Tabs.PvP:Paragraph("Note", {
    Title = "Note",
    Content = "The Infinite Season Wins script only works if you have the Skip Fight Timer gamepass and can fight twice in a row. Let the game run for six hours, then come back and enable it.",
    TitleAlignment = "Middle",
    ContentAlignment = Enum.TextXAlignment.Left
})

--------------------------------------------------
-- CONFIGURATION / MANAGERS
--------------------------------------------------

SaveManager:SetLibrary(Library)
InterfaceManager:SetLibrary(Library)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})

InterfaceManager:SetFolder("FluentEventsHub")
SaveManager:SetFolder("FluentEventsHub/SpecificGame")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)
Library:Notify{Title = "Fluent", Content = "CHub loaded successfully!", Duration = 8}
SaveManager:LoadAutoloadConfig()
