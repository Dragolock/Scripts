-- Load Fluent Renewed Library
local Library = loadstring(game:HttpGetAsync("https://github.com/ActualMasterOogway/Fluent-Renewed/releases/latest/download/Fluent.luau"))()
local SaveManager = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/SaveManager.luau"))()
local InterfaceManager = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/InterfaceManager.luau"))()

local Window = Library:Window{
    Title = "Pull A Sword Events",
    SubTitle = "By coco",
    TabWidth = 130,
    Size =  UDim2.fromOffset(500, 430),
    Resize = false, 
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftShift
}

-- Tabs
local Tabs = {
    Abyss = Window:CreateTab{Title = "Abyss Event", Icon = "fire"},
    Fishing = Window:CreateTab{Title = "Fishing Event", Icon = "fish"},
    Halloween = Window:CreateTab{Title = "Halloween Event", Icon = "pumpkin"},
    Settings = Window:CreateTab{Title = "Settings", Icon = "settings"}
}

local Options = Library.Options

--------------------------------------------------
-- ABYSS EVENT TAB
--------------------------------------------------

Tabs.Abyss:CreateToggle("DungeonFastAttack", {Title = "Dungeon Fast Attack", Default = false})
    :OnChanged(function(state)
        if state then
            task.spawn(function()
                while Options.DungeonFastAttack.Value do
                    game:GetService("ReplicatedStorage").Remotes.Events.Dungeon.OnDungeonClick:FireServer()
                    task.wait()
                end
            end)
        end
    end)

Tabs.Abyss:CreateToggle("TPRaidSkellys", {Title = "TP Raid Skellys", Default = false})
    :OnChanged(function(state)
        local player = game.Players.LocalPlayer
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:WaitForChild("HumanoidRootPart")
        local humanoid = character:FindFirstChildOfClass("Humanoid")

        if state then
            local bv = hrp:FindFirstChild("SkellyVelocity") or Instance.new("BodyVelocity")
            bv.Name = "SkellyVelocity"
            bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
            bv.Velocity = Vector3.zero
            bv.Parent = hrp
        else
            if hrp:FindFirstChild("SkellyVelocity") then hrp.SkellyVelocity:Destroy() end
            return
        end

        local torsos = {}

        local function refreshTorsos()
            torsos = {}
            for _, v in pairs(workspace:GetDescendants()) do
                if v:IsA("BasePart") and v.Name == "UpperTorso" then
                    local model = v:FindFirstAncestorOfClass("Model")
                    if not game.Players:GetPlayerFromCharacter(model) then
                        table.insert(torsos, v)
                    end
                end
            end
        end
        refreshTorsos()

        local torsoAdded = workspace.DescendantAdded:Connect(function(v)
            if v:IsA("BasePart") and v.Name == "UpperTorso" and not game.Players:GetPlayerFromCharacter(v.Parent) then
                table.insert(torsos, v)
            end
        end)

        local torsoRemoved = workspace.DescendantRemoving:Connect(function(v)
            if v:IsA("BasePart") and v.Name == "UpperTorso" then
                for i, t in ipairs(torsos) do
                    if t == v then table.remove(torsos, i) break end
                end
            end
        end)

        task.spawn(function()
            while Options.TPRaidSkellys.Value and character.Parent do
                if #torsos == 0 then refreshTorsos() end
                local nearest, nearestDist = nil, 100
                for _, t in ipairs(torsos) do
                    local d = (hrp.Position - t.Position).Magnitude
                    if d < nearestDist then nearestDist, nearest = d, t end
                end
                if nearest then
                    if humanoid and humanoid.Sit then humanoid.Sit = false end
                    hrp.CFrame = CFrame.new(nearest.Position + Vector3.new(0, -2, 0))
                end
                task.wait()
            end
            torsoAdded:Disconnect()
            torsoRemoved:Disconnect()
            if hrp:FindFirstChild("SkellyVelocity") then hrp.SkellyVelocity:Destroy() end
        end)
    end)

Tabs.Abyss:CreateToggle("GenerateSouls", {Title = "Generate Souls", Default = false})
    :OnChanged(function(state)
        local ReplicatedStorage = game.ReplicatedStorage
        local Players = game.Players
        local Workspace = game.Workspace
        local player = Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")
        local humanoid = char:FindFirstChildOfClass("Humanoid")

        if state then
            task.spawn(function()
                local bv = hrp:FindFirstChild("SketVelocity") or Instance.new("BodyVelocity")
                bv.Name = "SketVelocity"
                bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                bv.Velocity = Vector3.zero
                bv.Parent = hrp

                local remotes = ReplicatedStorage.Remotes.Events.Dungeon
                while Options.GenerateSouls.Value do
                    remotes.OnJoinDungeon:FireServer("Normal")
                    task.wait(0.5)
                    remotes.OnDungeonClick:FireServer()
                    remotes.OnLeaveDungeon:FireServer(true)
                    task.wait(0.1)
                end
                if hrp:FindFirstChild("SketVelocity") then hrp.SketVelocity:Destroy() end
            end)
        else
            if hrp:FindFirstChild("SketVelocity") then hrp.SketVelocity:Destroy() end
        end
    end)

Tabs.Abyss:CreateToggle("InstantTPSketies", {Title = "InstantTP Sketies", Default = false})
    :OnChanged(function(state)
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        if state then
            local bv = hrp:FindFirstChild("SketVelocity") or Instance.new("BodyVelocity")
            bv.Name = "SketVelocity"
            bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
            bv.Velocity = Vector3.zero
            bv.Parent = hrp
        else
            if hrp:FindFirstChild("SketVelocity") then hrp.SketVelocity:Destroy() end
        end
    end)

Tabs.Abyss:CreateButton{
    Title = "WalkSpeed 65",
    Description = "Set your speed to 65",
    Callback = function()
        local hum = game.Players.LocalPlayer.Character:WaitForChild("Humanoid")
        hum.WalkSpeed = 65
    end
}

--------------------------------------------------
-- FISHING EVENT TAB
--------------------------------------------------

Tabs.Fishing:CreateToggle("AutoFishBad", {Title = "Auto Fish (Bad)", Default = false})
    :OnChanged(function(state)
        local plr = game.Players.LocalPlayer
        local char = plr.Character or plr.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        if state then
            task.spawn(function()
                local Fishing = game.ReplicatedStorage.Remotes.Fishing
                while Options.AutoFishBad.Value and char.Parent do
                    hrp.CFrame = CFrame.new(-890, 10, -246)
                    hrp.Anchored = true
                    Fishing.CastRod:InvokeServer()
                    local start = tick()
                    while tick() - start < 18 do
                        Fishing.PlayerReaction:FireServer()
                        task.wait(0.05)
                    end
                    Fishing.ReelIn:FireServer(2.5)
                    Fishing.Stop:FireServer()
                    task.wait(1)
                end
                hrp.Anchored = false
            end)
        else
            hrp.Anchored = false
        end
    end)

--------------------------------------------------
-- HALLOWEEN EVENT TAB
--------------------------------------------------

Tabs.Halloween:CreateToggle("CollectPumpkins", {Title = "Collect Pumpkins", Default = false})
    :OnChanged(function(state)
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        if state then
            local ev = game.ReplicatedStorage.Remotes.Events.FollowTheUpdate
            ev:FireServer()
            game.ReplicatedStorage.Remotes.Functions.OnCodeRequest:InvokeServer("Pumpkin","YT_Arawrd")
        end

        task.spawn(function()
            while Options.CollectPumpkins.Value and char.Parent do
                local folder = workspace:FindFirstChild("HappyPumpkins")
                if folder then
                    for _, part in pairs(folder:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CFrame = hrp.CFrame
                            task.wait(0.05)
                        end
                    end
                end
                task.wait(0.1)
            end
        end)
    end)

--------------------------------------------------
-- CONFIGURATION / MANAGERS
--------------------------------------------------

SaveManager:SetLibrary(Library)
InterfaceManager:SetLibrary(Library)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})

InterfaceManager:SetFolder("FluentEventsHub")
SaveManager:SetFolder("FluentEventsHub/SpecificGame")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)
Library:Notify{Title = "Fluent", Content = "Script loaded successfully!", Duration = 8}
SaveManager:LoadAutoloadConfig()
