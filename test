-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local PlayerGui = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

-- PLAYER REFERENCES
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- SETTINGS
local MAX_DISTANCE = 1000
local LOCK_SMOOTHNESS = 0.01

-- STATE
local aimbotEnabled = false

-- VISIBILITY CHECK
local function isVisible(targetPart)
	if not LocalPlayer.Character then return false end

	local origin = Camera.CFrame.Position
	local direction = targetPart.Position - origin

	local params = RaycastParams.new()
	params.FilterType = Enum.RaycastFilterType.Blacklist
	params.FilterDescendantsInstances = {LocalPlayer.Character}
	params.IgnoreWater = true

	local result = Workspace:Raycast(origin, direction, params)
	return result and result.Instance:IsDescendantOf(targetPart.Parent)
end

-- GET NEAREST VISIBLE PLAYER
local function getNearestVisibleCharacter()
	local closest
	local shortest = MAX_DISTANCE

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
			local head = player.Character:FindFirstChild("Head")

			if humanoid and humanoid.Health > 0 and head and isVisible(head) then
				local distance = (Camera.CFrame.Position - head.Position).Magnitude
				if distance < shortest then
					shortest = distance
					closest = player.Character
				end
			end
		end
	end

	return closest
end

-- MAIN LOOP
RunService.RenderStepped:Connect(function()
	if not aimbotEnabled then return end

	local target = getNearestVisibleCharacter()
	if not target then return end

	local head = target:FindFirstChild("Head")
	if not head then return end

	-- Camera lock
	local targetCFrame = CFrame.new(Camera.CFrame.Position, head.Position)
	Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, LOCK_SMOOTHNESS)
end)

-- GUI BUTTON
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AimbotGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 100, 0, 50)
ToggleButton.Position = UDim2.new(0.5, -50, 0.9, 0)
ToggleButton.Text = "Aimbot OFF"
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Parent = ScreenGui

ToggleButton.MouseButton1Click:Connect(function()
	aimbotEnabled = not aimbotEnabled
	if aimbotEnabled then
		ToggleButton.Text = "Aimbot ON"
		ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
	else
		ToggleButton.Text = "Aimbot OFF"
		ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
	end
end)
