-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")

-- PLAYER REFERENCES
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- SETTINGS
local MAX_DISTANCE = 1000
local LOCK_SMOOTHNESS = 1
local FOV_RADIUS = 100

-- STATES
local aimbotEnabled = false
local fovEnabled = true

-- VISIBILITY CHECK
local function isVisible(part)
	if not LocalPlayer.Character then return false end

	local params = RaycastParams.new()
	params.FilterType = Enum.RaycastFilterType.Blacklist
	params.FilterDescendantsInstances = { LocalPlayer.Character }
	params.IgnoreWater = true

	local result = Workspace:Raycast(
		Camera.CFrame.Position,
		part.Position - Camera.CFrame.Position,
		params
	)

	return result and result.Instance:IsDescendantOf(part.Parent)
end

-- TARGET FINDER
local function getTarget()
	local best
	local shortest = MAX_DISTANCE
	local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= LocalPlayer and p.Character then
			local hum = p.Character:FindFirstChildOfClass("Humanoid")
			local head = p.Character:FindFirstChild("Head")

			if hum and hum.Health > 0 and head and isVisible(head) then
				local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
				if onScreen then
					local dist2D = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude

					if (not fovEnabled or dist2D <= FOV_RADIUS) and dist2D < shortest then
						shortest = dist2D
						best = head
					end
				end
			end
		end
	end

	return best
end

-- MAIN LOOP
local renderConnection
renderConnection = RunService.RenderStepped:Connect(function()
	if not aimbotEnabled then return end

	local head = getTarget()
	if not head then return end

	Camera.CFrame = CFrame.new(Camera.CFrame.Position, head.Position)
end)

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AimbotGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

-- AIMBOT BUTTON
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 100, 0, 50)
ToggleButton.Position = UDim2.new(0.5, -50, 0.88, 0)
ToggleButton.Text = "Aimbot OFF"
ToggleButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
ToggleButton.TextColor3 = Color3.new(1,1,1)
ToggleButton.Parent = ScreenGui

ToggleButton.MouseButton1Click:Connect(function()
	aimbotEnabled = not aimbotEnabled
	ToggleButton.Text = aimbotEnabled and "Aimbot ON" or "Aimbot OFF"
	ToggleButton.BackgroundColor3 = aimbotEnabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
end)

-- FOV TOGGLE BUTTON (LEFT)
local FovButton = Instance.new("TextButton")
FovButton.Size = UDim2.new(0, 40, 0, 50)
FovButton.Position = UDim2.new(0.5, -95, 0.88, 0)
FovButton.Text = "FOV"
FovButton.BackgroundColor3 = Color3.fromRGB(0,150,255)
FovButton.TextColor3 = Color3.new(1,1,1)
FovButton.TextScaled = true
FovButton.Parent = ScreenGui

FovButton.MouseButton1Click:Connect(function()
	fovEnabled = not fovEnabled
	FOVCircle.Visible = fovEnabled
	FovButton.BackgroundColor3 = fovEnabled and Color3.fromRGB(0,150,255) or Color3.fromRGB(60,60,60)
end)

-- TERMINATE BUTTON (RIGHT)
local TerminateButton = Instance.new("TextButton")
TerminateButton.Size = UDim2.new(0, 40, 0, 50)
TerminateButton.Position = UDim2.new(0.5, 55, 0.88, 0)
TerminateButton.Text = "X"
TerminateButton.BackgroundColor3 = Color3.fromRGB(0,0,0)
TerminateButton.TextColor3 = Color3.new(1,1,1)
TerminateButton.TextScaled = true
TerminateButton.Parent = ScreenGui

TerminateButton.MouseButton1Click:Connect(function()
	aimbotEnabled = false
	if renderConnection then renderConnection:Disconnect() end
	ScreenGui:Destroy()
end)

-- FOV CIRCLE
FOVCircle = Instance.new("Frame")
FOVCircle.Size = UDim2.new(0, FOV_RADIUS*2, 0, FOV_RADIUS*2)
FOVCircle.Position = UDim2.new(0.5, -FOV_RADIUS, 0.5, -FOV_RADIUS)
FOVCircle.AnchorPoint = Vector2.new(0.5,0.5)
FOVCircle.BackgroundTransparency = 1
FOVCircle.BorderSizePixel = 0
FOVCircle.Parent = ScreenGui

local UICorner = Instance.new("UICorner", FOVCircle)
UICorner.CornerRadius = UDim.new(1,0)

local Stroke = Instance.new("UIStroke", FOVCircle)
Stroke.Thickness = 2
Stroke.Color = Color3.fromRGB(0,255,0)
