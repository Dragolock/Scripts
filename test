local Players=game:GetService("Players")
local RunService=game:GetService("RunService")
local Workspace=game:GetService("Workspace")
local PlayerGui=Players.LocalPlayer:WaitForChild("PlayerGui")
local LocalPlayer=Players.LocalPlayer
local Camera=Workspace.CurrentCamera
local MAX_DISTANCE=1000
local LOCK_SMOOTHNESS=0.1
local aimbotEnabled=false

local function isVisible(part)
	if not LocalPlayer.Character then return false end
	local params=RaycastParams.new()
	params.FilterType=Enum.RaycastFilterType.Blacklist
	params.FilterDescendantsInstances={LocalPlayer.Character}
	params.IgnoreWater=true
	local result=Workspace:Raycast(Camera.CFrame.Position,part.Position-Camera.CFrame.Position,params)
	return result and result.Instance:IsDescendantOf(part.Parent)
end

local function getTarget()
	local character=LocalPlayer.Character
	if not character then return nil end
	local hrp=character:FindFirstChild("HumanoidRootPart")
	if not hrp then return nil end
	local best
	local shortest=MAX_DISTANCE
	for _,p in ipairs(Players:GetPlayers())do
		if p~=LocalPlayer and p.Character then
			local hum=p.Character:FindFirstChildOfClass("Humanoid")
			local head=p.Character:FindFirstChild("Head")
			if hum and hum.Health>0 and head and isVisible(head)then
				local dist3D=(head.Position-hrp.Position).Magnitude
				if dist3D<shortest then
					shortest=dist3D
					best=head
				end
			end
		end
	end
	return best
end

RunService.RenderStepped:Connect(function()
	if not aimbotEnabled then return end
	local head=getTarget()
	if not head then return end
	local current=Camera.CFrame
	local desired=CFrame.new(current.Position,head.Position)
	Camera.CFrame=current:Lerp(desired,LOCK_SMOOTHNESS)
end)

local espObjects={}
for _,plr in ipairs(Players:GetPlayers())do
	if plr~=LocalPlayer then
		local box=Drawing.new("Square")
		box.Thickness=1
		box.Color=Color3.fromRGB(0,255,0)
		box.Filled=false
		box.Visible=false
		espObjects[plr]=box
	end
end
Players.PlayerAdded:Connect(function(plr)
	if plr~=LocalPlayer then
		local box=Drawing.new("Square")
		box.Thickness=1
		box.Color=Color3.fromRGB(0,255,0)
		box.Filled=false
		box.Visible=false
		espObjects[plr]=box
	end
end)
Players.PlayerRemoving:Connect(function(plr)
	local box=espObjects[plr]
	if box then box:Remove()end
	espObjects[plr]=nil
end)
RunService.RenderStepped:Connect(function()
	for plr,box in pairs(espObjects)do
		local char=plr.Character
		if char then
			local head=char:FindFirstChild("Head")
			if head then
				local pos,onScreen=Camera:WorldToViewportPoint(head.Position)
				if onScreen then
					local size=30
					box.Size=Vector2.new(size,size)
					box.Position=Vector2.new(pos.X-size/2,pos.Y-size/2)
					box.Visible=true
				else
					box.Visible=false
				end
			else
				box.Visible=false
			end
		else
			box.Visible=false
		end
	end
end)

local ScreenGui=Instance.new("ScreenGui")
ScreenGui.Name="AimbotGUI"
ScreenGui.ResetOnSpawn=false
ScreenGui.Parent=PlayerGui

local ToggleButton=Instance.new("TextButton")
ToggleButton.Size=UDim2.new(0,100,0,50)
ToggleButton.Position=UDim2.new(0.5,-50,0.88,-50)
ToggleButton.Text="Aimbot OFF"
ToggleButton.BackgroundColor3=Color3.fromRGB(255,0,0)
ToggleButton.TextColor3=Color3.new(1,1,1)
ToggleButton.Parent=ScreenGui
ToggleButton.MouseButton1Click:Connect(function()
	aimbotEnabled=not aimbotEnabled
	ToggleButton.Text=aimbotEnabled and "Aimbot ON"or"Aimbot OFF"
	ToggleButton.BackgroundColor3=aimbotEnabled and Color3.fromRGB(0,255,0)or Color3.fromRGB(255,0,0)
end)

local TerminateButton=Instance.new("TextButton")
TerminateButton.Size=UDim2.new(0,40,0,50)
TerminateButton.Position=UDim2.new(0.5,55,0.88,-50)
TerminateButton.Text="X"
TerminateButton.BackgroundColor3=Color3.fromRGB(0,0,0)
TerminateButton.TextColor3=Color3.new(1,1,1)
TerminateButton.TextScaled=true
TerminateButton.Parent=ScreenGui
TerminateButton.MouseButton1Click:Connect(function()
	aimbotEnabled=false
	ScreenGui:Destroy()
end)
