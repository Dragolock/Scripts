local Library = loadstring(game:HttpGetAsync("https://github.com/ActualMasterOogway/Fluent-Renewed/releases/latest/download/Fluent.luau"))()
local SaveManager = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/SaveManager.luau"))()
local InterfaceManager = loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/ActualMasterOogway/Fluent-Renewed/master/Addons/InterfaceManager.luau"))()

local Window = Library:Window{
    Title = "CHub - Pull A Sword",
    SubTitle = "By secret",
    TabWidth = 100,
    Size =  UDim2.fromOffset(430, 320),
    Resize = false, 
    Theme = "United GNOME",
    MinimizeKey = Enum.KeyCode.LeftShift
}

-- Tabs
local Tabs = {
    XMAS = Window:CreateTab{Title = "XMAS", Icon = "phosphor-sword-bold"},
    Fishing = Window:CreateTab{Title = "Fishing", Icon = "phosphor-sword-bold"},
    PvP = Window:CreateTab{Title = "PvP", Icon = "phosphor-sword-bold"},
    Settings = Window:CreateTab{Title = "Settings", Icon = "phosphor-sword-bold"}
}

local Options = Library.Options

Tabs.Fishing:CreateToggle("AutoFish", {Title = "Auto Fish", Default = false})
:OnChanged(function(state)
    if state then
        task.spawn(function()
            local Players = game:GetService("Players")
            local Workspace = game:GetService("Workspace")
            local ReplicatedStorage = game:GetService("ReplicatedStorage")

            local player = Players.LocalPlayer
            local character = player.Character or player.CharacterAdded:Wait()
            local hrp = character:WaitForChild("HumanoidRootPart")
            local Fishing = ReplicatedStorage.Remotes.Fishing
            local FISH_POS = CFrame.new(-890, 10, -246)

            while Options.AutoFish.Value and character.Parent do
                hrp.CFrame = FISH_POS
                task.wait(2)

                hrp.Anchored = true
                Fishing.CastRod:InvokeServer()

                local fishDetected = false
                local fishConnection = Workspace.DescendantAdded:Connect(function(obj)
                    if obj:IsA("Model") and obj.Name == "Fish" then
                        fishDetected = true
                    end
                end)

                while not fishDetected and character.Parent and Options.AutoFish.Value do
                    Fishing.PlayerReaction:FireServer()
                    task.wait(0.05)
                end

                fishConnection:Disconnect()

                if fishDetected and Options.AutoFish.Value then
                    Fishing.ReelIn:FireServer()
                    task.wait(0.05)
                    Fishing.Stop:FireServer()
                end

                task.wait(2)
            end

            hrp.Anchored = false
        end)
    end
end)


Tabs.Fishing:CreateToggle("GenCrystals", {
    Title = "Generate Crystals",
    Default = false
}):OnChanged(function(state)
    local r = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Events")

    if state then
        r.RemoveC:FireServer(1)
        task.spawn(function()
            while Options.GenCrystals.Value do
                for i = 1, 20 do
                    r.WinMegaBossEvent:FireServer("Dragon6", "Normal")
                end
                task.wait()
            end
        end)
    else
        r.RemoveC:FireServer(0)
    end
end)

Tabs.Fishing:CreateButton{
    Title = "Cartographer Pieces",
    Description = "Collect all Cartographer Pieces instantly",
    Callback = function()

        local Players = game:GetService("Players")
        local player = Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")

        local function fireTouchOnce(obj)
            local part = obj:FindFirstAncestorWhichIsA("BasePart")
            if part and firetouchinterest then
                task.spawn(function()
                    firetouchinterest(part, root, 1)
                    task.wait()
                    firetouchinterest(part, root, 0)
                end)
            end
        end

        for _, d in ipairs(workspace:GetDescendants()) do
            if d:IsA("TouchTransmitter") then
                fireTouchOnce(d)
            end
        end

    end
}

Tabs.XMAS:CreateToggle("AutoClick", {Title = "Auto Click", Default = false})
    :OnChanged(function(state)
        if state then
            task.spawn(function()
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local ClickEvent = ReplicatedStorage.Remotes.Events.ClickEvent

                while Options.AutoClick.Value do
                    ClickEvent:FireServer()
                    task.wait()
                end
            end)
        end
    end)

Tabs.XMAS:CreateToggle("FastHatchEventEgg", {
    Title = "FAST Hatch Event Egg",
    Default = false
}):OnChanged(function(state)
    if state then
        task.spawn(function()
            local player = game.Players.LocalPlayer
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")

            local remote = game:GetService("ReplicatedStorage")
                :WaitForChild("GameClient")
                :WaitForChild("Events")
                :WaitForChild("RemoteFunction")
                :WaitForChild("BuyEgg")

            local args = {"Hall Egg2", "Buy1"}

            task.spawn(function()
                while Options.FastHatchEventEgg.Value do
                    hrp.CFrame = CFrame.new(5539, 324, 9841)
                    task.wait()
                end
            end)

            while Options.FastHatchEventEgg.Value do
                remote:InvokeServer(unpack(args))
                task.wait(0.05)
            end
        end)
    end
end)

Tabs.XMAS:CreateToggle("AutoTower", {
    Title = "Auto Tower",
    Default = false
}):OnChanged(function(state)
    if state then
        task.spawn(function()
            local towerEvent = game:GetService("ReplicatedStorage"):WaitForChild("TowerEventRemotes"):WaitForChild("TowerRewardsEvent")

            local lastFalse = tick()

            while Options.AutoTower.Value do
                for i = 1, 20 do
                    if not Options.AutoTower.Value then break end
                    towerEvent:FireServer("-20", true)
                    task.wait(1.5 / 20)
                end
                if tick() - lastFalse >= 1.5 then
                    towerEvent:FireServer("-20", false)
                    lastFalse = tick()
                end
            end
        end)
    end
end)

local XMASDropdown = Tabs.XMAS:CreateDropdown("XMASBossSelect", {
    Title = "Select XMAS Boss",
    Values = {
        "Evil Elf",
        "Gingerbread",
        "Santa Ravager",
        "Blizzard Enforcer",
        "Crimson Claus"
    },
    Default = "Evil Elf"
})

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local event = ReplicatedStorage:WaitForChild("EventFolder"):WaitForChild("WinBossEvent")
local removeEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Events"):WaitForChild("RemoveC")

Tabs.XMAS:CreateToggle("GenerateSnowflakes", {
    Title = "Generate Snowflakes",
    Default = false
}):OnChanged(function(state)
    if state then
        task.spawn(function()
            removeEvent:FireServer(1)
            task.wait(0.1)

            while Options.GenerateSnowflakes.Value do
                local bossSelection = XMASDropdown.Value

                for i = 1, 20 do
                    if bossSelection == "Evil Elf" then
                        event:FireServer("1")
                    elseif bossSelection == "Gingerbread" then
                        event:FireServer("2")
                    elseif bossSelection == "Santa Ravager" then
                        event:FireServer("3")
                    elseif bossSelection == "Blizzard Enforcer" then
                        event:FireServer("4")
                    elseif bossSelection == "Crimson Claus" then
                        event:FireServer("5")
                    end
                end

                task.wait()
            end
        end)
    else
        removeEvent:FireServer(0)
    end
end)


Tabs.XMAS:CreateButton({
    Title = "Remove Drop Popups",
    Description = "Deletes Drop Popups (rejoin to see again)",
    Callback = function()
        local Players = game:GetService("Players")
        local LocalPlayer = Players.LocalPlayer

        if LocalPlayer then
            local folder = LocalPlayer:FindFirstChild("RewardAnimationFolder")
            if folder then
                folder:Destroy()
            end
        end
    end
})

local MenuDropdown = Tabs.XMAS:CreateDropdown("XMASMenuSelect", {
    Title = "Select Menu",
    Values = {
        "Workshop",
        "Glove Shop",
        "Event Shop"
    },
    Default = "Workshop"
})

Tabs.XMAS:CreateButton{
    Title = "Open Menu",
    Description = "Opens selected XMAS menu",
    Callback = function()
        local player = game.Players.LocalPlayer
        local uiGroup = player.PlayerGui.MainUI.UI_Group
        local selected = MenuDropdown.Value

        if selected == "Workshop" then
            uiGroup.XmasWorkshop.Visible = true

        elseif selected == "Glove Shop" then
            uiGroup.SantaBossClicks.Visible = true

        elseif selected == "Event Shop" then
            uiGroup.EventShop.Visible = true
        end
    end
}

Tabs.XMAS:CreateButton{
    Title = "Use Christmas Portal",
    Description = "Teleports you to XMAS World",
    Callback = function()
        local args = {"-50", false}
        local portalRemote = game:GetService("ReplicatedStorage")
            :WaitForChild("Remotes")
            :WaitForChild("Events")
            :WaitForChild("PortalC")
        portalRemote:FireServer(unpack(args))
    end
}

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local function getPlayerNames()
    local t = {}
    for _, player in ipairs(Players:GetPlayers()) do
        table.insert(t, player.Name)
    end
    return t
end

local playerNames = getPlayerNames()

-- Buy Potions Toggle
local buyPotionsToggle = Tabs.PvP:CreateToggle("BuyPotions", {
    Title = "Buy Potions",
    Default = false
})

buyPotionsToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            while buyPotionsToggle.Value do
                local remotes = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Events")
                remotes.HalloweenShopEvent:FireServer("WinsPotions")
                remotes.HalloweenShopEvent:FireServer("ShinyPotions")
                task.wait()
            end
        end)
    end
end)

local autoPvPToggle = Tabs.PvP:CreateToggle("AutoPvP", {
    Title = "Auto PvP",
    Default = false
})

local dropdownRef = Tabs.PvP:CreateDropdown("PvPTarget", {
    Title = "Select PvP Target",
    Values = playerNames,
    Default = playerNames[1] or ""
})

autoPvPToggle:OnChanged(function(state)
    if state then
        task.spawn(function()
            while autoPvPToggle.Value do
                local r = ReplicatedStorage.Remotes.Events
                local targetName = dropdownRef.Value
                if targetName and targetName ~= "" then
                    r.WinEvent_PVP:FireServer(targetName, true, true)
                end
                task.wait(0.7)
            end
        end)
    end
end)

-- Refresh Players Button
Tabs.PvP:CreateButton({
    Title = "Refresh Players",
    Callback = function()
        playerNames = getPlayerNames()
        dropdownRef:SetValues(playerNames)
        dropdownRef:SetValue(playerNames[1] or "")
    end
})

local notepvp = Tabs.PvP:Paragraph("Note", {
    Title = "Note",
    Content = "The Infinite Season Wins script only works if you have the Skip Fight Timer gamepass and can fight twice in a row. Let the game run for six hours, then come back and enable it.",
    TitleAlignment = "Middle",
    ContentAlignment = Enum.TextXAlignment.Left
})

--------------------------------------------------
-- CONFIGURATION / MANAGERS
--------------------------------------------------

SaveManager:SetLibrary(Library)
InterfaceManager:SetLibrary(Library)

SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})

InterfaceManager:SetFolder("FluentEventsHub")
SaveManager:SetFolder("FluentEventsHub/SpecificGame")

InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)
Library:Notify{Title = "Fluent", Content = "CHub loaded successfully!", Duration = 8}
SaveManager:LoadAutoloadConfig()
